{"version":3,"sources":["statistic.js"],"names":["define","ko","$tools","PaginationMod","UserListFilterMod","context","self","parent","data","loading","subject_id","observable","previewUrl","currentQuestionId","dealTpl","today_mark","answered_status","templates","button_visible","button_disable","task_name_cn","user_id","start_at","end_at","dataList","observableArray","switch_stat","switch_button","isShow","change_button","index","console","log","getData","page","ajax","url","stage","export","success","returnData","renderPagination","per_page","total","window","downloadData","oReq","XMLHttpRequest","open","responseType","onreadystatechange","readyState","status","URL","createObjectURL","response","alert","responseText","oMyForm","FormData","append","send","$","off","on","init","userInput","getSubject","test","statistic"],"mappings":"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","file":"statistic.js","sourcesContent":["define(['knockout', 'Tools','PaginationMod', 'UserListFilterMod', 'popbox', 'slideout', 'ko-mapping','ko-datepicker'], function (ko, $tools,PaginationMod,UserListFilterMod) {\r\n    return function (context) {\r\n        var self = this;\r\n\r\n        self.parent = context.parent;\r\n        self.data = context.data;\r\n\r\n        self.loading = self.parent.loading;\r\n        self.loading(false);\r\n\r\n        self.subject_id = ko.observable('101');\r\n\r\n        self.previewUrl = ko.observable('');\r\n        self.currentQuestionId = ko.observable('');\r\n        self.dealTpl = ko.observable({});\r\n\r\n        self.today_mark = ko.observable(0); //今天标记的题目数\r\n        self.answered_status = ko.observable(1);\r\n\r\n        self.templates = ko.observable({});\r\n        self.button_visible = ko.observable(false);\r\n        self.button_disable = ko.observable(true);\r\n\r\n        self.task_name_cn = ['题目标记', '题目验证'],\r\n        self.user_id = ko.observable('');\r\n        self.start_at = ko.observable('');\r\n        self.end_at = ko.observable('');\r\n        self.dataList = ko.observableArray([]);\r\n        self.switch_stat = ko.observable(0);\r\n        //导航菜单\r\n        self.switch_button = ko.observable(0);\r\n        self.isShow = ko.observable(false);\r\n        //任务切换\r\n        self.change_button = function (index) {\r\n            self.switch_button(index);\r\n            // self.templates({});\r\n            self.dataList([]);\r\n            self.isShow(false);\r\n            console.log(self.dataList());\r\n        };\r\n        //搜索\r\n        self.getData = function(page){\r\n            //console.log(self.dataList());\r\n            self.isShow(true);\r\n            self.switch_stat(0);\r\n           // self.dataList([]);\r\n            console.log('search');\r\n            console.log(self.switch_button());\r\n            $tools.ajax({\r\n                url:'multiple_answers/stat',\r\n                data:{\r\n                    stage:self.switch_button()+1,\r\n                    start_at:self.start_at(),\r\n                    end_at: self.end_at(),\r\n                    user_id:self.user_id(),\r\n                    subject_id: self.subject_id(),\r\n                    //subject_id:'',\r\n                    page: page || 1,\r\n                    export:self.switch_stat()\r\n                },\r\n                success:function(returnData){\r\n                    self.dataList(returnData.data);\r\n                    PaginationMod.renderPagination(returnData.page, returnData.per_page , returnData.total, 'getData');\r\n                }\r\n            });\r\n        };\r\n        window.getData = self.getData; \r\n\r\n        //下载数据\r\n        self.downloadData = function(){\r\n            console.log(self.switch_stat());\r\n            self.switch_stat(1);\r\n            let oReq = new XMLHttpRequest();\r\n            let url = 'multiple_answers/stat';\r\n            oReq.open(\"POST\", url, true);\r\n            oReq.responseType = \"blob\";\r\n            oReq.onreadystatechange = function(){\r\n                 if (oReq.readyState==4){\r\n                    if (oReq.status==200){\r\n                        window.open(URL.createObjectURL(oReq.response));\r\n                    }\r\n                    else{\r\n                        alert(oReq.responseText);\r\n                    }\r\n                 }\r\n            };\r\n            var oMyForm = new FormData();\r\n            oMyForm.append(\"subject_id\", self.subject_id() ||'');\r\n            oMyForm.append(\"stage\", self.switch_stat()+1 ||'');\r\n            oMyForm.append(\"user_id\", self.user_id() ||'');\r\n            oMyForm.append(\"start_at\", self.start_at()||'');\r\n            oMyForm.append(\"end_at\", self.end_at());\r\n            oMyForm.append(\"export\",self.switch_stat());\r\n            oReq.send(oMyForm);\r\n        };\r\n\r\n        $('body').off('statistic_page_ready').on('statistic_page_ready', function () {\r\n            //初始化用户筛选\r\n            UserListFilterMod.init({\r\n                url: '/service/all-users',\r\n                userInput: $('#name'),\r\n                getSubject: self.subject_id\r\n            });\r\n        });\r\n\r\n        if (self.data.test) {\r\n            window.statistic = self;\r\n        }\r\n    };\r\n});\r\n//# sourceMappingURL=es6/maps/mark.js.map"],"sourceRoot":"/source/"}