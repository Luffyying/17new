{"version":3,"sources":["mark.js"],"names":["define","ko","$tools","Task","context","self","parent","data","loading","subject_id","observable","previewUrl","currentQuestionId","dealTpl","today_mark","answered_status","templates","button_visible","button_disable","isWhite","list","observableArray","white_list","question_id","questionDetialParams","v","whiteData","postData","ma_id","answers","countArr","arrs","isShow","getQuestions","ajax","url","success","returnData","d","console","log","_id","question","content","sub_contents","undetermined_answers","item","arr","a","count","i","push","answers_list","getNum","today_my_mark_count","subscribe","submit","$","find","each","p","val","k","split","length","s","ar","newArr","prop","newArr_c","n","slice","last","j","t","JSON","parse","msgTip","off","on","test","window","mark"],"mappings":"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","file":"mark.js","sourcesContent":["define(['knockout', 'Tools', 'Task', 'popbox', 'slideout', 'ko-mapping','question_detail'], function (ko, $tools,Task) {\r\n    return function (context) {\r\n\r\n        var self = this;\r\n        \r\n        self.parent = context.parent;\r\n        self.data = context.data;\r\n\r\n        self.loading = self.parent.loading;\r\n        self.loading(false);\r\n        self.subject_id = ko.observable(101);\r\n\r\n        self.previewUrl = ko.observable('');\r\n        self.currentQuestionId = ko.observable('');\r\n        self.dealTpl = ko.observable({});\r\n\r\n        self.today_mark = ko.observable(0); //今天标记的题目数\r\n        self.answered_status = ko.observable(1);\r\n\r\n        self.templates = ko.observable({});\r\n        self.button_visible = ko.observable(false);\r\n        self.button_disable = ko.observable(false);\r\n\r\n        self.isWhite = false;\r\n        self.list = ko.observableArray([]);\r\n        self.white_list = ko.observableArray([]);\r\n        self.question_id = ko.observable('');\r\n        self.questionDetialParams = {\r\n            question_id:self.question_id,\r\n             v:new Task(),\r\n            // v:\r\n            list:self.list,\r\n            white_list:self.white_list,\r\n            isWhite:self.isWhite\r\n        };\r\n        self.whiteData = ko.observableArray([]);\r\n        //提交的数据\r\n        let postData = {\r\n            ma_id:'',\r\n            answers:[]\r\n        };\r\n        let countArr =[];\r\n        //获取题目\r\n        let arrs = [];\r\n        self.isShow = ko.observable(false);\r\n        self.getQuestions = function(){\r\n            $tools.ajax({\r\n                url:'/multiple_answers/extract',\r\n                data:{\r\n                    subject_id:self.subject_id()\r\n                },\r\n                success:function(returnData){\r\n                    let d = returnData.data;\r\n                    console.log(d);\r\n                    //console.log(d.question.content.sub_contents[0]);\r\n                    postData.ma_id = d._id;\r\n                    self.list(d.question.content.sub_contents);\r\n                    self.question_id(d.question_id);\r\n                    self.white_list(d.question.content.sub_contents.undetermined_answers);\r\n                    //self.white_list(d.undetermined_answers);\r\n                    console.log(d.undetermined_answers);\r\n                    countArr = [];//记录多答案的数目\r\n                    for(let item of d.undetermined_answers){\r\n                        let arr = [];\r\n                        let a = item.answers;\r\n                        let count = 0;\r\n                        for(let i of a){\r\n                            count++;\r\n                            arr.push(i.answers_list);\r\n                        }\r\n                        countArr.push(count);\r\n                        // postData.answers.push(arr);\r\n                        arrs.push(arr);\r\n                    }\r\n                    console.log(arrs);\r\n                    console.log(countArr);\r\n                   \r\n                    //self.questionDetialParams.v.addList = arrs;\r\n                    //console.log(self.questionDetialParams.v.addList);\r\n                    //console.log(JSON.stringify(postData));\r\n                    self.isShow(true);\r\n                    self.button_visible(true);\r\n                    self.button_disable(false);\r\n                }\r\n            });\r\n\r\n        };\r\n        self.getNum = function(){\r\n            $tools.ajax({\r\n                url:'/multiple_answers/tips',\r\n                data:{\r\n                    subject_id:self.subject_id()\r\n                },\r\n                success:function(returnData){\r\n                    //console.log(returnData.data.today_my_mark_count);\r\n                    self.today_mark(returnData.data.today_my_mark_count);\r\n                }\r\n            });\r\n        };\r\n        self.subject_id.subscribe(function(){\r\n            self.getNum();\r\n            self.isShow(false);\r\n            self.button_visible(false);\r\n        });\r\n        self.submit = function(){\r\n            $('.white_list').find('textarea').each(function(i){\r\n                \r\n                var p = $(this).val();\r\n                    var k = p.split('\\n');\r\n                    //console.log(k);\r\n                    //var ar = [];\r\n                    for(var i=0;i<k.length;i++){\r\n                        console.log(k[i]);\r\n                        var s = k[i].split(',');\r\n                        ar.push(s);\r\n                        \r\n\r\n                    }\r\n            });\r\n            let newArr = [];\r\n            let arr = [];\r\n            $('input[type=\"checkbox\"]').each(function(){\r\n                arr.push($(this).prop('checked'));\r\n            });\r\n            console.log(arr);\r\n            let newArr_c = [];//true false\r\n           for(let i=0;i<countArr.length;i++){\r\n                let n=0;\r\n                newArr_c.push(arr.slice(n.countArr[i]));\r\n                countArr[i] = n;\r\n           }\r\n           let last = [];\r\n           for(let j=0;j<arrs.length;j++){\r\n                let k = [];\r\n                for(let t=0;t<arrs[j].length;t++){\r\n                    if(newArr_c[j][t]==true){\r\n                        k.push(arrs[j][t]);\r\n                    }\r\n                }\r\n                last.push(k);\r\n           }\r\n            //console.log(arrs);\r\n            // for(let i=0;i<arrs.length;i++){\r\n            //     if(arr[i]==true){\r\n            //         newArr.push(arrs[i]);\r\n            //     }\r\n            // }\r\n            //var array = self.questionDetialParams.v.addValue().split(',');\r\n            //console.log(array);\r\n           // postData.answers = newArr;\r\n            //postData.answers.push(array);\r\n            postData.answers = last;\r\n           console.log(last);\r\n          \r\n            $tools.ajax({\r\n                url:'/multiple_answers/mark',\r\n                data:JSON.parse(postData),\r\n                //data:JSON.stringify(postData),\r\n                success:function(data){\r\n\r\n                    self.button_disable(true);\r\n                    self.today_mark(self.today_mark() + 1);\r\n                    $tools.msgTip('操作成功', 'success');\r\n                }\r\n            });\r\n            \r\n           // self.questionDetialParams.v.addList.push(array);\r\n            //self.white_list.push(self.questionDetialParams.v.addValue());\r\n            //console.log(self.questionDetialParams.v.addList);\r\n            //console.log(self.white_list());\r\n        };\r\n    \r\n        $('body').off('mark_page_ready').on('mark_page_ready', function () {\r\n            self.getNum();\r\n            console.log($('input'));\r\n        });\r\n        if(self.data.test){\r\n            window.mark = self;\r\n        }\r\n\r\n    };\r\n});\r\n//# sourceMappingURL=es6/maps/mark.js.map"],"sourceRoot":"/source/"}